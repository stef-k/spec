---
id: T-006
title: SSE client (Bearer, reconnect, stop on non-Today)
status: todo
labels: [sse, api]
deps: [T-003]
owner: ""
inputs:
  - Groups.md
outputs: []
timebox: "2h"
---

## Summary
Implement a lightweight SSE client using HttpClient streaming to subscribe to `/api/sse/stream/location-update/{userName}` with Bearer token. Support reconnect with backoff and stop streams when date != Today or page not visible.

## Acceptance Criteria (measurable)
- [ ] Connects to SSE with Bearer and receives `data:` frames.
- [ ] Reconnects with backoff after drops; logs reconnection attempts.
- [ ] Stops all streams when switching off Today or when page disappears.

## Steps
- [ ] Read inputs
- [ ] Implement streaming read loop with cancellation
- [ ] Add backoff strategy and stop hooks
- [ ] Unit-test parser for sample SSE lines (optional)

## Verification
- `curl -i -H "Authorization: Bearer $TOKEN" -H "Accept: text/event-stream" "$SERVER/api/sse/stream/location-update/$USERNAME"`
- Manual: Observe events update a test log in the app during a moving user.

## Notes
See Groups.md “Backend Gaps” for auth/heartbeat guidance.

